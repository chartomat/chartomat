!function(){function t(t,n){return t.map(function(t){return t[n]})}function n(t){for(var n=t.length;n>0&&null==t[n-1];)n--;return t.slice(0,n)}function e(e){for(var o=n(e[0]),a=e.slice(1),r=t(a,0),i=[],c=1;c<o.length;c++)i.push({name:o[c],x:r,y:n(t(a,c)),type:"scatter"});return i}function o(t){var n=e(t),o=document.getElementById("chart"),a={};Plotly.newPlot(o,n,a,f)}function a(t){var n=document.getElementById("table");return new Handsontable(n,{data:t,minCols:26,minRows:100,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0,afterChange:function(t,n){o(this.getData())}})}function r(){var t=h.getData().map(function(t){return n(t)}).filter(function(t){return t.length>0}),e=""===window.location.hash||"#"===window.location.hash;if(e)$.ajax({method:"POST",url:"http://s1.chartomat.io/charts/",data:JSON.stringify(t),contentType:"application/json"}).done(function(t){console.log("Saved",t),s=t.id,window.location.hash=t.id,m.show(),localStorage.setItem("chart-"+t.id+"-token",t.token)}).fail(function(t,n){console.log("Error",n)});else{var o=localStorage.getItem("chart-"+s+"-token");$.ajax({method:"PUT",url:"http://s1.chartomat.io/charts/"+s,headers:{"X-Chart-Token":o},data:JSON.stringify(t),contentType:"application/json"}).done(function(t){console.log("Updated",t)}).fail(function(t,n){console.log("Error",n)})}}function i(t){if(t)return $.ajax({method:"GET",url:"http://s1.chartomat.io/charts/"+t,dataType:"json"}).then(function(t){return t.raw_data}).fail(function(t,n){console.log("Error",n)});var n=[["","London","Warsaw"],["Jan",7,-2],["Feb",7,-3],["Mar",9,3],["Apr",11,8],["May",14,14],["Jun",16,16],["Jul",19,18],["Aug",19,18],["Sep",17,14],["Oct",13,9],["Nov",10,3],["Dec",7,-1]];return $.Deferred().resolve(n).promise()}function c(){return window.location.hash&&window.location.hash.replace("#","")}function d(){s=c(),i(s).done(function(t){h=a(t),s&&m.show()}),window.onhashchange=l}function u(){s=c(),i(s).done(function(t){o(t)})}function l(t){var n=t.newURL.split("#")[1];n!==s&&(s=n,i(s).done(function(t){h&&h.loadData(t)}))}var h,s,f={displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud"]},m=function(){var t=document.getElementById("share-btn");return{show:function(){t&&t.removeAttribute("hidden")}}}(),p=function(){function t(){var t=window.location.hash.replace("#","");return'<iframe \n   src="http://chartomat.io/embed/#'+t+'" \n   style="border:none;height:400px;width:600px">\n</iframe>'}var n=document.getElementById("share-tooltip"),e=document.getElementById("embed-code");return{toggle:function(o){n.hasAttribute("hidden")?(e.innerHTML=t(),n.removeAttribute("hidden")):n.setAttribute("hidden","hidden")}}}();window.chartomat={init:d,initEmbedded:u,save:r,shareTooltip:p}}();