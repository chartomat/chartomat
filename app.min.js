!function(){function t(t,e){return t.map(function(t){return t[e]})}function e(t){for(var e=t.length;e>0&&null==t[e-1];)e--;return t.slice(0,e)}function n(n,o){for(var a=e(n[0]),r=n.slice(1),i=t(r,0),c=[],d=o&&o.chartType||"line",l={line:"scatter",bar:"bar","stacked-bar":"bar"}[d],u=1;u<a.length;u++)c.push({name:a[u],x:i,y:e(t(r,u)),type:l});return c}function o(t,e){var o=document.getElementById("chart"),a=n(t,e),r={title:e.title,barmode:{"stacked-bar":"stack"}[e&&e.chartType]},i={displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage"]};Plotly.newPlot(o,a,r,i)}function a(t){var e=document.getElementById("table");return new Handsontable(e,{data:t,minCols:26,minRows:100,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0,afterChange:function(t,e){o(s.chart.raw_data,s.chart.options)}})}function r(){var t=s.chart.raw_data.map(function(t){return e(t)}).filter(function(t){return t.length>0});if(s.chart.id){var n=localStorage.getItem("chart-"+s.chart.id+"-token");$.ajax({method:"PUT",url:h+"charts/"+s.chart.id,headers:{"X-Chart-Token":n},data:JSON.stringify(s.chart),contentType:"application/json"}).done(function(t){console.log("Updated",t)}).fail(function(t,e){console.log("Error",e)})}else $.ajax({method:"POST",url:h+"charts/",data:JSON.stringify({raw_data:t,options:s.chart.options}),contentType:"application/json"}).done(function(t){console.log("Saved",t),s.chart.id=t.id,window.location.hash=t.id,f.show(),localStorage.setItem("chart-"+t.id+"-token",t.token)}).fail(function(t,e){console.log("Error",e)})}function i(t){if(t)return $.ajax({method:"GET",url:h+"charts/"+t,dataType:"json"}).fail(function(t,e){console.log("Error",e)});var e={id:void 0,raw_data:[["","London","Warsaw"],["Jan",7,-2],["Feb",7,-3],["Mar",9,3],["Apr",11,8],["May",14,14],["Jun",16,16],["Jul",19,18],["Aug",19,18],["Sep",17,14],["Oct",13,9],["Nov",10,3],["Dec",7,-1]],options:{chartType:"line"}};return $.Deferred().resolve(e).promise()}function c(){return window.location.hash&&window.location.hash.replace("#","")}function d(){var t=c();i(t).done(function(t){s.chart=t,s.table=a(t.raw_data),v.load(t.options),t.id&&f.show()}),window.onhashchange=u}function l(){var t=c();i(t).done(function(t){s.chart=t,o(t.raw_data,t.options)})}function u(t){var e=t.newURL.split("#")[1];e!==chart.id&&i(e).done(function(t){s.chart=t,v.load(t.options),t.id&&f.show(),s.table&&s.table.loadData(t.raw_data)})}var h="http://s1.chartomat.io/",s={table:void 0,chart:{id:void 0,raw_data:void 0,options:void 0}},f=function(){var t=document.getElementById("share-btn");return{show:function(){t&&t.removeAttribute("hidden")}}}(),p=function(t,e,n){function o(){i.removeAttribute("hidden"),document.addEventListener("click",r,!0),e&&e()}function a(){i.setAttribute("hidden","hidden"),n&&n()}function r(t){for(var e=t.target;e!==i&&null!==e;)e=e.parentNode;e!==i&&(document.removeEventListener("click",r,!0),setTimeout(a,0))}var i=document.getElementById(t);return function(){i.hasAttribute("hidden")?o():a()}},m=function(){function t(){var t=window.location.hash.replace("#","");return'<iframe \n   src="http://chartomat.io/embed/#'+t+'" \n   style="border:none;height:400px;width:600px">\n</iframe>'}var e=document.getElementById("embed-code");return{toggle:p("share-tooltip",function(){e.innerHTML=t()})}}(),v=function(){var t=(document.getElementById("options"),document.getElementById("chart-title")),e=document.querySelectorAll("input[name='chart-type']");return{toggle:p("options"),load:function(n){t.value=n.title||"",[].forEach.call(e,function(t){t.value===n.chartType?t.setAttribute("checked","checked"):t.removeAttribute("checked")})},setTitle:function(t){s.chart.options.title=t,o(s.chart.raw_data,s.chart.options)},setChartType:function(t){s.chart.options.chartType=t,o(s.chart.raw_data,s.chart.options)}}}();window.chartomat={init:d,initEmbedded:l,save:r,shareTooltip:m,options:v}}();