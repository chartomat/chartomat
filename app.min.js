function makeToggle(e){function t(e){var t=document.createEvent("Event");t.initEvent(e,!0,!0),a.dispatchEvent(t)}function n(){a.removeAttribute("hidden"),document.addEventListener("click",i,!0),t("show")}function o(){a.setAttribute("hidden","hidden"),t("hide")}function i(e){for(var t=e.target;t!==a&&null!==t;)t=t.parentNode;t!==a&&(document.removeEventListener("click",i,!0),setTimeout(o,0))}var a;if(e instanceof Element)a=e;else{if(!(e instanceof String||"string"==typeof e))throw new TypeError("Invalid selector. Should be either a string selector or an instance of Element.");a=document.querySelector(e)}return function(){a.hasAttribute("hidden")?n():o()}}!function(){function e(){return["horizontal","vertical"][+(window.innerWidth>window.innerHeight)]}function t(e){return e[u.clientAxis]||e.touches&&e.touches[0][u.clientAxis]}function n(e){a.className="dragging",h=t(e),d.addEventListener("mousemove",o),d.addEventListener("touchmove",o),window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i)}function o(e){var n=t(e)-h;g>m+n&&(n=g-f),p>v-n&&(n=v-p);var o=f+n+"px";a.style[u.offsetName]=o,r.style[u.sizeName]=m+n+"px",c.style[u.offsetName]=o,c.style[u.sizeName]=v-n+"px";var i=document.createEvent("UIEvents");i.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(i)}function i(e){d.removeEventListener("mousemove",o),d.removeEventListener("touchmove",o),f=a.getBoundingClientRect()[u.offsetName],m=r.getBoundingClientRect()[u.sizeName],v=c.getBoundingClientRect()[u.sizeName],a.className=""}var a=document.querySelector("#gutter"),r=document.querySelector("#tableContainer"),c=document.querySelector("#chartContainer"),d=document.querySelector("body"),s=e(),l={vertical:{clientAxis:"clientX",offsetName:"left",sizeName:"width"},horizontal:{clientAxis:"clientY",offsetName:"top",sizeName:"height"}},u=l[s],h=0,f=a.getBoundingClientRect()[u.offsetName],m=r.getBoundingClientRect()[u.sizeName],v=c.getBoundingClientRect()[u.sizeName],g=200,p=200;a.addEventListener("mousedown",n),a.addEventListener("touchstart",n),window.addEventListener("resize",function(){s!==e()&&(s=e(),a.style[u.offsetName]="",r.style[u.sizeName]="",c.style[u.offsetName]="",c.style[u.sizeName]="",u=l[s],h=0,f=a.getBoundingClientRect()[u.offsetName],m=r.getBoundingClientRect()[u.sizeName],v=c.getBoundingClientRect()[u.sizeName])})}(),function(){function e(e,t){return e.map(function(e){return e[t]})}function t(t){return t.length?t[0].map(function(n,o){return e(t,o)}):[]}function n(e){var n=e.filter(a(i));return t(t(n).filter(a(i)))}function o(e){for(var t=e.length;t>0&&(null===e[t-1]||""===e[t-1]);)t--;return e.slice(0,t)}function i(e){return e.every(function(e){return null===e||""===e})}function a(e){return function(){return!e.apply(null,arguments)}}function r(t,o){var i=n(t);if(i.length>0){for(var a=i[0],r=i.slice(1),c=e(r,0),d=[],s=o&&o.chartType||"line",l={line:"scatter",bar:"bar","stacked-bar":"bar"}[s],u=1;u<a.length;u++)d.push({name:a[u],x:c,y:e(r,u),type:l});return d}return[{}]}function c(e,t){var n=Plotly.d3.select("#chart").node(),o=r(e,t),i={title:t.title,barmode:{"stacked-bar":"stack"}[t&&t.chartType]},a={displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage"]};Plotly.newPlot(n,o,i,a),window.onresize=function(){Plotly.Plots.resize(n)}}function d(e){var t=document.getElementById("table"),n=document.getElementById("tableContainer");t.style.width=t.offsetWidth+"px",t.style.height=t.offsetHeight+"px";var o=new Handsontable(t,{data:e,minCols:26,minRows:100,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0,afterChange:function(e,t){c(g.chart.raw_data,g.chart.options)}});return window.addEventListener("resize",function(){t.style.width=n.offsetWidth+"px",t.style.height=n.offsetHeight+"px",o.render()}),o}function s(){var e=g.chart.raw_data.map(function(e){return o(e)});if(g.chart.id){var t=localStorage.getItem("chart-"+g.chart.id+"-token");$.ajax({method:"PUT",url:v+"charts/"+g.chart.id,headers:{"X-Chart-Token":t},data:JSON.stringify({raw_data:e,options:g.chart.options}),contentType:"application/json"}).done(function(e){console.log("Updated",e)}).fail(function(e,t){console.log("Error",t)})}else $.ajax({method:"POST",url:v+"charts/",data:JSON.stringify({raw_data:e,options:g.chart.options}),contentType:"application/json"}).done(function(e){console.log("Saved",e),g.chart.id=e.id,window.location.hash=e.id,p.show(),localStorage.setItem("chart-"+e.id+"-token",e.token)}).fail(function(e,t){console.log("Error",t)})}function l(e){if(e)return $.ajax({method:"GET",url:v+"charts/"+e,dataType:"json"}).fail(function(e,t){console.log("Error",t)});var t={id:void 0,raw_data:[["","London","Warsaw"],["Jan",7,-2],["Feb",7,-3],["Mar",9,3],["Apr",11,8],["May",14,14],["Jun",16,16],["Jul",19,18],["Aug",19,18],["Sep",17,14],["Oct",13,9],["Nov",10,3],["Dec",7,-1]],options:{chartType:"line"}};return $.Deferred().resolve(t).promise()}function u(){return window.location.hash&&window.location.hash.replace("#","")}function h(){var e=u();l(e).done(function(e){g.chart=e,g.table=d(e.raw_data),y.load(e.options),e.id&&p.show()}),window.onhashchange=m}function f(){var e=u();l(e).done(function(e){g.chart=e,c(e.raw_data,e.options)})}function m(e){var t=e.newURL.split("#")[1];t!==chart.id&&l(t).done(function(e){g.chart=e,y.load(e.options),e.id&&p.show(),g.table&&g.table.loadData(e.raw_data)})}var v="http://s1.chartomat.io/",g={table:void 0,chart:{id:void 0,raw_data:void 0,options:void 0}},p=function(){var e=document.getElementById("share-btn");return{show:function(){e&&e.removeAttribute("hidden")}}}(),w=function(){function e(){var e=window.location.hash.replace("#","");return'<iframe \n   src="http://chartomat.io/embed/#'+e+'" \n   style="border:none;height:400px;width:600px">\n</iframe>'}var t=document.getElementById("share-tooltip"),n=document.getElementById("embed-code");return t?(t.addEventListener("show",function(){n.innerHTML=e()}),{toggle:makeToggle(t)}):{}}(),y=function(){var e=(document.getElementById("options"),document.getElementById("chart-title")),t=document.querySelectorAll("input[name='chart-type']");return{toggle:makeToggle("#options"),load:function(n){e.value=n.title||"",[].forEach.call(t,function(e){e.value===n.chartType?e.setAttribute("checked","checked"):e.removeAttribute("checked")})},setTitle:function(e){g.chart.options.title=e,c(g.chart.raw_data,g.chart.options)},setChartType:function(e){g.chart.options.chartType=e,c(g.chart.raw_data,g.chart.options)}}}();window.chartomat={init:h,initEmbedded:f,save:s,shareTooltip:w,options:y}}();