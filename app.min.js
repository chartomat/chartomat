function makeToggle(t){function e(t){var e=document.createEvent("Event");e.initEvent(t,!0,!0),r.dispatchEvent(e)}function n(){r.removeAttribute("hidden"),document.addEventListener("click",a,!0),e("show")}function o(){r.setAttribute("hidden","hidden"),e("hide")}function a(t){for(var e=t.target;e!==r&&null!==e;)e=e.parentNode;e!==r&&(document.removeEventListener("click",a,!0),setTimeout(o,0))}var r;if(t instanceof Element)r=t;else{if(!(t instanceof String||"string"==typeof t))throw new TypeError("Invalid selector. Should be either a string selector or an instance of Element.");r=document.querySelector(t)}return function(){r.hasAttribute("hidden")?n():o()}}!function(){function t(t,e){return t.map(function(t){return t[e]})}function e(e){return e.length?e[0].map(function(n,o){return t(e,o)}):[]}function n(t){var n=t.filter(r(a));return e(e(n).filter(r(a)))}function o(t){for(var e=t.length;e>0&&(null===t[e-1]||""===t[e-1]);)e--;return t.slice(0,e)}function a(t){return t.every(function(t){return null===t||""===t})}function r(t){return function(){return!t.apply(null,arguments)}}function i(e,o){var a=n(e);if(a.length>0){for(var r=a[0],i=a.slice(1),c=t(i,0),d=[],l=o&&o.chartType||"line",u={line:"scatter",bar:"bar","stacked-bar":"bar"}[l],s=1;s<r.length;s++)d.push({name:r[s],x:c,y:t(i,s),type:u});return d}return[{}]}function c(t,e){var n=Plotly.d3.select("#chart").node(),o=i(t,e),a={title:e.title,barmode:{"stacked-bar":"stack"}[e&&e.chartType]},r={displaylogo:!1,modeBarButtonsToRemove:["sendDataToCloud","toImage"]};Plotly.newPlot(n,o,a,r),window.onresize=function(){Plotly.Plots.resize(n)}}function d(t){var e=document.getElementById("table"),n=document.getElementById("tableContainer");e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px";var o=new Handsontable(e,{data:t,minCols:26,minRows:100,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0,afterChange:function(t,e){c(v.chart.raw_data,v.chart.options)}});return window.addEventListener("resize",function(){e.style.width=n.offsetWidth+"px",e.style.height=n.offsetHeight+"px",o.render()}),o}function l(){var t=v.chart.raw_data.map(function(t){return o(t)});if(v.chart.id){var e=localStorage.getItem("chart-"+v.chart.id+"-token");$.ajax({method:"PUT",url:m+"charts/"+v.chart.id,headers:{"X-Chart-Token":e},data:JSON.stringify({raw_data:t,options:v.chart.options}),contentType:"application/json"}).done(function(t){console.log("Updated",t)}).fail(function(t,e){console.log("Error",e)})}else $.ajax({method:"POST",url:m+"charts/",data:JSON.stringify({raw_data:t,options:v.chart.options}),contentType:"application/json"}).done(function(t){console.log("Saved",t),v.chart.id=t.id,window.location.hash=t.id,g.show(),localStorage.setItem("chart-"+t.id+"-token",t.token)}).fail(function(t,e){console.log("Error",e)})}function u(t){if(t)return $.ajax({method:"GET",url:m+"charts/"+t,dataType:"json"}).fail(function(t,e){console.log("Error",e)});var e={id:void 0,raw_data:[["","London","Warsaw"],["Jan",7,-2],["Feb",7,-3],["Mar",9,3],["Apr",11,8],["May",14,14],["Jun",16,16],["Jul",19,18],["Aug",19,18],["Sep",17,14],["Oct",13,9],["Nov",10,3],["Dec",7,-1]],options:{chartType:"line"}};return $.Deferred().resolve(e).promise()}function s(){return window.location.hash&&window.location.hash.replace("#","")}function h(){var t=s();u(t).done(function(t){v.chart=t,v.table=d(t.raw_data),y.load(t.options),t.id&&g.show()}),window.onhashchange=p}function f(){var t=s();u(t).done(function(t){v.chart=t,c(t.raw_data,t.options)})}function p(t){var e=t.newURL.split("#")[1];e!==chart.id&&u(e).done(function(t){v.chart=t,y.load(t.options),t.id&&g.show(),v.table&&v.table.loadData(t.raw_data)})}var m="http://s1.chartomat.io/",v={table:void 0,chart:{id:void 0,raw_data:void 0,options:void 0}},g=function(){var t=document.getElementById("share-btn");return{show:function(){t&&t.removeAttribute("hidden")}}}(),w=function(){function t(){var t=window.location.hash.replace("#","");return'<iframe \n   src="http://chartomat.io/embed/#'+t+'" \n   style="border:none;height:400px;width:600px">\n</iframe>'}var e=document.getElementById("share-tooltip"),n=document.getElementById("embed-code");return e?(e.addEventListener("show",function(){n.innerHTML=t()}),{toggle:makeToggle(e)}):{}}(),y=function(){var t=(document.getElementById("options"),document.getElementById("chart-title")),e=document.querySelectorAll("input[name='chart-type']");return{toggle:makeToggle("#options"),load:function(n){t.value=n.title||"",[].forEach.call(e,function(t){t.value===n.chartType?t.setAttribute("checked","checked"):t.removeAttribute("checked")})},setTitle:function(t){v.chart.options.title=t,c(v.chart.raw_data,v.chart.options)},setChartType:function(t){v.chart.options.chartType=t,c(v.chart.raw_data,v.chart.options)}}}();window.chartomat={init:h,initEmbedded:f,save:l,shareTooltip:w,options:y}}();